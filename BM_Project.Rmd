---
title: "ScRNA Seq Project"
output: html_notebook
---
<!--

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

--> 
# Libraries
```{r}
library(dplyr)
library(Seurat)
```


# Load Data
```{r}
filename <- "C:/Users/SU084/Documents/Ghobrial/Projects/Dexa scRNAseq/Data/GL1024BM_raw_feature_bc_matrix.h5"
BM_data.data <- Read10X_h5(filename, use.names = TRUE, unique.features = TRUE)

```

# Quality Control
```{r}
# The [[ operator can add columns to object metadata. This is a great place to stash QC stats
# Calculating percent Mitochondrial 
BM_data[["percent.mt"]] <- PercentageFeatureSet(BM_data, pattern = "^MT-")

# Visualize QC metrics as a violin plot
VlnPlot(BM_data, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)

```

# Visualize Feature-Feature Relationships

```{r}
# FeatureScatter is typically used to visualize feature-feature relationships, but can be used
# for anything calculated by the object, i.e. columns in object metadata, PC scores etc.

plot1 <- FeatureScatter(BM_data, feature1 = "nCount_RNA", feature2 = "percent.mt")
plot2 <- FeatureScatter(BM_data, feature1 = "nCount_RNA", feature2 = "nFeature_RNA")
CombinePlots(plots = list(plot1, plot2))

```

# Identify Highly Variable Genes
```{r}
#Normalize
BM_data <- NormalizeData(BM_data, normalization.method = "LogNormalize", scale.factor = 10000)

# Identification of highly variable features
BM_data <- FindVariableFeatures(BM_data, selection.method = "vst", nfeatures = 2000)

# Identify the 10 most highly variable genes
top10 <- head(VariableFeatures(BM_data), 10)
top10

```

# Scale

```{r}
all.genes <- rownames(BM_data)
BM_data <- ScaleData(BM_data, features = all.genes)

# Linear dimension reduction

BM_data <- RunPCA(BM_data, features = VariableFeatures(object = BM_data))
```

# PCA Results
```{r}
# Examine and visualize PCA results a few different ways
print(BM_data[["pca"]], dims = 1:5, nfeatures = 5)

VizDimLoadings(BM_data, dims = 1:2, reduction = "pca")
```

```{r}
# Plot PC
DimPlot(BM_data, reduction = "pca")

DimHeatmap(BM_data, dims = 1, cells = 500, balanced = TRUE)

```


```{r}
# Determine the ‘dimensionality’ of the dataset

# NOTE: This process can take a long time for big datasets, comment out for expediency. More
# approximate techniques such as those implemented in ElbowPlot() can be used to reduce
# computation time
BM_data <- JackStraw(BM_data, num.replicate = 100)
BM_data <- ScoreJackStraw(BM_data, dims = 1:20)
```

# JackStrawPlot
```{r}
# The JackStrawPlot function provides a visualization tool for comparing \
# the distribution of p-values for each PC with a uniform distribution 
# (dashed line). ‘Significant’ PCs will show a strong enrichment of 
# features with low p-values (solid curve above the dashed line). In this # case it appears that there is a sharp drop-off in significance after the #first 10-12 PCs.

JackStrawPlot(BM_data, dims = 1:15)


```

# Elbow PLot
```{r}
ElbowPlot(BM_data)
```

# Cluster
```{r}
# Cluster 
BM_data <- FindNeighbors(BM_data, dims = 1:10)
BM_data <- FindClusters(BM_data, resolution = 0.5)
head(Idents(BM_data), 5)

BM_data <- RunUMAP(BM_data, dims = 1:10)
DimPlot(BM_data, reduction = "umap")
```


```{r}
```


```{r}
```

